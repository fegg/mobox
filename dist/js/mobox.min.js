/*!
 * mobox 1.0.3
 * MOBOX = Modern Dialog + Pop Box + Overlay + Extensible CSS3 Effects, Inspired by Codrop&#39;s DialogEffect at github.com/codrops/DialogEffects 
 * @dependencies 
 *  1. classy.js <http://faso.me/classy>
 *  2. modernizr
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * built at 1428422439564 
 * Copyright 2015, FASO.ME <http://www.faso.me>
 */
!function(e,t){"object"==typeof exports?module.exports=t(require("./classy")):"function"==typeof define&&define.amd?define(["classy"],t):e.Mobox=t(e.classy)}(this,function(e){function t(t,n){o(t,function(t){e.toggle(t,n)})}function o(e,t){for(var o=e.length,n=0;o>n;n++)t(e[n])}function n(e,t){return e&&e.tagName&&e.nodeName&&1===e.nodeType&&(t?t===e.tagName:!0)}function i(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e}function s(o,n){this.el=o,this.options=i({morphDurationOpen:parseInt(o.getAttribute("data-morph-open-duration")||1500),morphDurationClose:parseInt(o.getAttribute("data-morph-close-duration")||250),morphOpenDelay:parseInt(o.getAttribute("data-morph-open-delay")||0),morphCloseDelay:parseInt(o.getAttribute("data-morph-close-delay")||0),morphOpenData:o.getAttribute("data-morph-open")||null,morphCloseData:o.getAttribute("data-morph-close")||null,morphTag:o.getAttribute("data-morph-tag")||"path",morphOpenEffect:o.getAttribute("data-morph-open-effect")||"elastic",morphCloseEffect:o.getAttribute("data-morph-close-effect")||"easeout",sticky:!1,clScene:"mobox-scene",clSceneActive:"mobox-scene-active",actions:{btnIdXXX:function(){}},effect:o.getAttribute("data-effect")||s.defaults.effect,effectRel:o.getAttribute("data-effect-rel")||s.defaults.effectRel},this.options),i(this.options,n),this.ctrlClose=this.el.querySelectorAll("[data-mobox-close]"),this.elemsRel=document.querySelectorAll(this.options.effectRel),this.effectClass="mobox-effect-"+this.options.effect,t(this.elemsRel,this.effectClass+"-rel"),e.add(o,this.effectClass),this._initSvg(),this.isOpen=!1,this._initEvents(),this._initScenes()}var r={animations:Modernizr.cssanimations},a={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},p=a[Modernizr.prefixed("animation")],c=function(e,t){var o=function(e){if(r.animations){if(e.target!=this)return;this.removeEventListener(p,o)}t&&"function"==typeof t&&t.call()};r.animations?e.addEventListener(p,o):o()};return s.prototype.destroy=function(){this.el.parentNode.removeChild(this.el)},s.prototype.options={destroyAfterClosed:!1,onOpen:function(){return!1},onOpened:function(){return!1},onClose:function(){return!1},onClosed:function(){return!1}},s.prototype._initSvg=function(){var e=this.el.querySelector(".mobox-morph-shape"),t=e?e.querySelector("svg"):null;if(t&&e){if("undefined"==typeof Snap)return void alert("Snap.svg not found! SVG Mobox need Snap.svn to function properly!");var o=Snap(t),n=this.options.morphTag,i={},s={},r=s[n]=this.options.morphCloseData,a=i[n]=this.options.morphOpenData;this.svg={morph:{openData:a,closeData:r,open:i,close:s,target:o.select(n)},onOpen:function(e){if(e.svg.morph.openData){var t=e.svg.morph;return 0===e.options.morphOpenDelay?t.target.stop().animate(t.open,e.options.morphDurationOpen,mina[e.options.morphOpenEffect]):void setTimeout(function(){t.target.stop().animate(t.open,e.options.morphDurationOpen,mina[e.options.morphOpenEffect])},e.options.morphOpenDelay)}},onClose:function(e){if(e.svg.morph.closeData){var t=e.svg.morph;return 0===e.options.morphCloseDelay?t.target.stop().animate(t.close,e.options.morphDurationClose,mina[e.options.morphCloseEffect]):void setTimeout(function(){t.target.stop().animate(t.close,e.options.morphDurationClose,mina[e.options.morphCloseEffect])},e.options.morphCloseDelay)}}}}},s.prototype._initScenes=function(){this.scenes=this.el.querySelectorAll("."+this.options.clScene)},s.prototype.showScene=function(t,n){n=n||{};var i,s,r,a=this;if(t=this.options.clScene+"-"+(t||"default"),o(this.scenes,function(o){e.remove(o,a.options.clSceneActive),e.has(o,t)&&!i&&(i=o)}),i){for(var p in n)if(s=i.querySelector(".mobox-"+p)||i.querySelector("[data-"+p+"]"),r=n[p],s)if("object"==typeof r&&r.attrs)for(var c in r.attrs)s.setAttribute(c,r.attrs[c]);else"undefined"!=typeof s.value?s.value=n[p]:"undefined"!=typeof s.innerHTML&&(s.innerHTML=n[p]);e.add(i,a.options.clSceneActive)}},s.prototype._initEvents=function(){var e=this;o(this.ctrlClose,function(t){t.addEventListener("click",e.hide.bind(e))}),document.addEventListener("keydown",function(t){var o=t.keyCode||t.which;27===o&&e.isOpen&&e.hide()}),this.options.sticky||this.el.querySelector(".mobox-overlay").addEventListener("click",this.hide.bind(this));for(var t in this.options.actions){var n=document.getElementById(t),i=this.options.actions[t],s=i.evtName?i.func:i;evtName=i.evtName||"click",n&&!function(t){t.el.addEventListener(t.evtName,function(){t.action.call(e,t)})}({el:n,evtName:evtName,actionKey:t,action:s})}},s.prototype.show=function(){var o=this;this.isOpen||(e.add(this.el,"mobox-open"),t(this.elemsRel,this.effectClass+"-open"),c(this.el.querySelector(".mobox-inner"),function(){o.options.onOpened(o)}),this.options.onOpen(this),this.svg&&this.svg.onOpen(this),this.isOpen=!0)},s.prototype.hide=function(){var o=this;this.isOpen&&(e.remove(this.el,"mobox-open"),t(this.elemsRel,this.effectClass+"-open"),e.add(o.el,"mobox-close"),c(this.el.querySelector(".mobox-inner"),function(){e.remove(o.el,"mobox-close"),o.options.onClosed(o)}),this.options.onClose(this),this.svg&&this.svg.onClose(this),this.isOpen=!1)},s.prototype.toggle=function(){return this.isOpen?this.hide():this.show()},s.defaults={effect:"lv",effectRel:"body",svgEffects:["dg","panther","lava","anna"]},s.isSvgEffect=function(e){for(var t=s.defaults.svgEffects,o=t.length,n=!1,i=0;o>i;i++)if(e===t[i]){n=!0;break}return n},s.show=function(e){e=e||{};var t=e.dom,o=e.tpl;return n(t)?(delete e.dom,new s(t,e)):"string"==typeof t&&(t=document.getElementById(t))?(delete e.dom,new s(t,e)):void n(o,"SCRIPT")},s});